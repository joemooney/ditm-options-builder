<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DITM Options Portfolio Builder</title>
    <link rel="stylesheet" href="/static/css/style.css?v=7">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <i class="fas fa-chart-line"></i>
                <span>DITM Options Builder</span>
            </div>
            <div class="nav-menu">
                <a href="#" class="nav-link active" data-page="dashboard">
                    <i class="fas fa-th-large"></i> Dashboard
                </a>
                <a href="#" class="nav-link" data-page="scan">
                    <i class="fas fa-search"></i> New Scan
                </a>
                <a href="#" class="nav-link" data-page="performance">
                    <i class="fas fa-chart-bar"></i> Performance
                </a>
                <a href="#" class="nav-link" data-page="docs">
                    <i class="fas fa-book"></i> Documentation
                </a>
                <a href="#" class="nav-link" data-page="settings">
                    <i class="fas fa-cog"></i> Settings
                </a>
                <button id="theme-toggle" class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
                    <i class="fas fa-sun"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <div class="container">
            <!-- Dashboard Page -->
            <div id="page-dashboard" class="page active">
                <div class="page-header">
                    <h1><i class="fas fa-th-large"></i> Dashboard</h1>
                    <p>Track your active positions and recommended opportunities</p>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-bolt"></i> Quick Actions</h2>
                    </div>
                    <div class="card-body">
                        <div class="button-group">
                            <button class="btn btn-primary" onclick="showPage('scan')">
                                <i class="fas fa-search"></i> Run New Scan
                            </button>
                            <button class="btn btn-secondary" onclick="updatePerformance()">
                                <i class="fas fa-sync"></i> Update Performance
                            </button>
                            <button class="btn btn-secondary" onclick="showPage('docs')">
                                <i class="fas fa-book"></i> View Documentation
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Active Positions -->
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-chart-line"></i> Active Positions</h2>
                        <p style="font-size: 0.9rem; color: var(--text-secondary); margin: 0;">Positions you actually hold in your Schwab account</p>
                    </div>
                    <div class="card-body">
                        <!-- Active Positions Summary -->
                        <div class="stats-grid" style="margin-bottom: 1.5rem;">
                            <div class="stat-card">
                                <div class="stat-icon blue">
                                    <i class="fas fa-dollar-sign"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-label">Invested</div>
                                    <div class="stat-value" id="stat-active-invested">$0.00</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon green">
                                    <i class="fas fa-arrow-up"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-label">Current Value</div>
                                    <div class="stat-value" id="stat-active-value">$0.00</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon purple">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-label">P&L</div>
                                    <div class="stat-value" id="stat-active-pnl">$0.00</div>
                                </div>
                            </div>
                        </div>

                        <div id="active-positions-table">
                            <p class="text-muted">Loading...</p>
                        </div>
                    </div>
                </div>

                <!-- Recommended Positions -->
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-lightbulb"></i> Recommended Positions</h2>
                        <p style="font-size: 0.9rem; color: var(--text-secondary); margin: 0;">Recommendations you haven't opened yet (Hypothetical)</p>
                    </div>
                    <div class="card-body">
                        <!-- Recommended Positions Summary -->
                        <div class="stats-grid" style="margin-bottom: 1.5rem;">
                            <div class="stat-card">
                                <div class="stat-icon blue">
                                    <i class="fas fa-dollar-sign"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-label">Hypothetical Cost</div>
                                    <div class="stat-value" id="stat-recommended-invested">$0.00</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon green">
                                    <i class="fas fa-arrow-up"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-label">Current Value</div>
                                    <div class="stat-value" id="stat-recommended-value">$0.00</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon purple">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-label">P&L</div>
                                    <div class="stat-value" id="stat-recommended-pnl">$0.00</div>
                                </div>
                            </div>
                        </div>

                        <div id="recommended-positions-table">
                            <p class="text-muted">No data available. Run a scan to get started.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scan Page -->
            <div id="page-scan" class="page">
                <div class="page-header">
                    <h1><i class="fas fa-search"></i> Run Options Scan</h1>
                    <p>Scan for deep-in-the-money call options</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-cog"></i> Scan Configuration</h2>
                    </div>
                    <div class="card-body">
                        <form id="scan-form">
                            <div class="form-group">
                                <label for="tickers-input">
                                    <i class="fas fa-list"></i> Ticker Symbols
                                    <span id="ticker-count-scan" class="help-text">Add tickers using Enter, comma, or space. Manage your watchlist in Settings.</span>
                                </label>
                                <div class="ticker-input-container">
                                    <input type="text" id="tickers-input" class="form-control"
                                           placeholder="Add more tickers or use your watchlist below...">
                                    <div id="ticker-chips" class="ticker-chips"></div>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-rocket"></i> Run Scan
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Scan Results -->
                <div id="scan-results" class="card" style="display: none;">
                    <div class="card-header">
                        <h2><i class="fas fa-check-circle"></i> Scan Results</h2>
                    </div>
                    <div class="card-body">
                        <div id="scan-results-content"></div>
                    </div>
                </div>
            </div>

            <!-- Performance Page -->
            <div id="page-performance" class="page">
                <div class="page-header">
                    <h1><i class="fas fa-chart-bar"></i> Performance Analytics</h1>
                    <p>Track your strategy performance over time</p>
                    <button class="btn btn-secondary" onclick="updatePerformance()">
                        <i class="fas fa-sync"></i> Refresh Data
                    </button>
                </div>

                <!-- Risk Metrics -->
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-shield-alt"></i> Risk Metrics</h2>
                    </div>
                    <div class="card-body">
                        <div id="risk-metrics-grid" class="metrics-grid">
                            <p class="text-muted">Loading...</p>
                        </div>
                    </div>
                </div>

                <!-- Positions Table -->
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-table"></i> All Positions</h2>
                    </div>
                    <div class="card-body">
                        <div id="performance-table">
                            <p class="text-muted">Loading...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Documentation Page -->
            <div id="page-docs" class="page">
                <div class="page-header">
                    <h1><i class="fas fa-book"></i> Documentation</h1>
                    <p>Guides and references for DITM options trading</p>
                </div>

                <div class="docs-nav">
                    <button class="btn btn-outline" onclick="loadDoc('user_guide')">
                        <i class="fas fa-user-graduate"></i> User Guide
                    </button>
                    <button class="btn btn-outline" onclick="loadDoc('schwab_setup')">
                        <i class="fas fa-key"></i> Schwab Setup
                    </button>
                    <button class="btn btn-outline" onclick="loadDoc('tracking_guide')">
                        <i class="fas fa-chart-line"></i> Tracking Guide
                    </button>
                    <button class="btn btn-outline" onclick="loadDoc('readme')">
                        <i class="fas fa-info-circle"></i> README
                    </button>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div id="doc-content" class="doc-content">
                            <h2>Welcome to the DITM Options Portfolio Builder</h2>
                            <p>Select a document from above to view its contents.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="page-settings" class="page">
                <div class="page-header">
                    <h1><i class="fas fa-cog"></i> Settings</h1>
                    <p>Configure filter parameters and preferences</p>
                </div>

                <!-- Ticker Management -->
                <div class="card">
                    <div class="card-header">
                        <h2>
                            <i class="fas fa-list"></i> Ticker Watchlist
                            <i class="fas fa-info-circle tooltip-icon"
                               data-tooltip="Manage your stock watchlist. These tickers will be used for scans and are saved in web_config.json."></i>
                        </h2>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="new-ticker-input">
                                <i class="fas fa-plus-circle"></i> Add Ticker Symbol
                            </label>
                            <div class="ticker-add-container">
                                <input type="text" id="new-ticker-input" class="form-control"
                                       placeholder="Enter ticker (e.g., AAPL)" maxlength="5"
                                       style="text-transform: uppercase;">
                                <button type="button" class="btn btn-primary" onclick="addTicker()">
                                    <i class="fas fa-plus"></i> Add
                                </button>
                            </div>
                        </div>

                        <div class="ticker-list-header">
                            <h3>Current Watchlist</h3>
                            <span id="ticker-count" class="badge">0 tickers</span>
                        </div>
                        <div id="ticker-list" class="ticker-list">
                            <p class="text-muted">Loading...</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-header-with-help">
                            <h2><i class="fas fa-sliders-h"></i> Filter Parameters</h2>
                            <button type="button" class="btn btn-outline btn-sm" onclick="loadDoc('user_guide')">
                                <i class="fas fa-question-circle"></i> View User Guide
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <form id="settings-form">
                            <div class="settings-grid">
                                <div class="form-group">
                                    <label>
                                        MIN_DELTA
                                        <i class="fas fa-info-circle tooltip-icon"
                                           data-tooltip="Minimum delta (0.80 = option moves 80Â¢ per $1 stock move). Higher = more conservative, stock-like behavior. See User Guide for details."></i>
                                    </label>
                                    <input type="number" id="setting-min-delta" class="form-control"
                                           step="0.01" min="0" max="1" value="0.80">
                                    <small>Option must move at least this much with the stock (0.80-0.95 recommended)</small>
                                </div>
                                <div class="form-group">
                                    <label>
                                        MAX_DELTA
                                        <i class="fas fa-info-circle tooltip-icon"
                                           data-tooltip="Maximum delta (0.95 avoids extremely deep ITM). Prevents tying up too much capital. See User Guide for details."></i>
                                    </label>
                                    <input type="number" id="setting-max-delta" class="form-control"
                                           step="0.01" min="0" max="1" value="0.95">
                                    <small>Avoid options too deep in the money (limits capital inefficiency)</small>
                                </div>
                                <div class="form-group">
                                    <label>
                                        MIN_INTRINSIC_PCT
                                        <i class="fas fa-info-circle tooltip-icon"
                                           data-tooltip="Minimum intrinsic value % (85% = most premium is 'real value'). Protects against time decay. Higher = more conservative. See User Guide for details."></i>
                                    </label>
                                    <input type="number" id="setting-min-intrinsic" class="form-control"
                                           step="0.01" min="0" max="1" value="0.85">
                                    <small>At least 85% of premium must be intrinsic value (reduces time decay risk)</small>
                                </div>
                                <div class="form-group">
                                    <label>
                                        MIN_DTE
                                        <i class="fas fa-info-circle tooltip-icon"
                                           data-tooltip="Minimum days to expiration (90 days = 3 months). Avoids accelerated time decay. More days = safer. See User Guide for details."></i>
                                    </label>
                                    <input type="number" id="setting-min-dte" class="form-control"
                                           step="1" min="0" value="90">
                                    <small>Must have at least 90 days until expiration (180-365 for long-term)</small>
                                </div>
                                <div class="form-group">
                                    <label>
                                        MAX_IV
                                        <i class="fas fa-info-circle tooltip-icon"
                                           data-tooltip="Maximum implied volatility (30% = moderate). Rejects highly volatile stocks. Lower = more stable stocks. See User Guide for details."></i>
                                    </label>
                                    <input type="number" id="setting-max-iv" class="form-control"
                                           step="0.01" min="0" max="2" value="0.30">
                                    <small>Avoid highly volatile stocks (0.30 = 30% max volatility)</small>
                                </div>
                                <div class="form-group">
                                    <label>
                                        MAX_SPREAD_PCT
                                        <i class="fas fa-info-circle tooltip-icon"
                                           data-tooltip="Maximum bid-ask spread % (2% max). Ensures liquidity and minimizes trading costs. Lower = more liquid. See User Guide for details."></i>
                                    </label>
                                    <input type="number" id="setting-max-spread" class="form-control"
                                           step="0.001" min="0" max="0.1" value="0.02">
                                    <small>Spread can't exceed 2% of option price (ensures liquidity)</small>
                                </div>
                                <div class="form-group">
                                    <label>
                                        MIN_OI
                                        <i class="fas fa-info-circle tooltip-icon"
                                           data-tooltip="Minimum open interest (500 contracts). Higher = easier to buy/sell, tighter spreads. 1000+ for large positions. See User Guide for details."></i>
                                    </label>
                                    <input type="number" id="setting-min-oi" class="form-control"
                                           step="50" min="0" value="500">
                                    <small>At least 500 open contracts (ensures reasonable liquidity)</small>
                                </div>
                                <div class="form-group">
                                    <label>
                                        MAX_IMMEDIATE_LOSS_PCT
                                        <i class="fas fa-info-circle tooltip-icon"
                                           data-tooltip="Maximum immediate loss % cap (15% = 0.15). Formula: 5% + (DTE/365)*5%. Prevents overly expensive options. Longer DTE allows higher loss. See User Guide for details."></i>
                                    </label>
                                    <input type="number" id="setting-max-immediate-loss" class="form-control"
                                           step="0.01" min="0.05" max="0.20" value="0.15">
                                    <small>Maximum cap for immediate loss % (adjusted by DTE formula)</small>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Save Settings
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="resetSettings()">
                                    <i class="fas fa-undo"></i> Reset to Defaults
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="spinner"></div>
        <p id="loading-message">Processing...</p>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Position Detail Modal -->
    <div id="position-detail-modal" class="modal" style="display: none;">
        <div class="modal-backdrop" onclick="closePositionDetail()"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="modal-title"><i class="fas fa-chart-line"></i> Position Analysis</h2>
                <button class="modal-close" onclick="closePositionDetail()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="position-detail-content">
                <p class="text-muted">Loading...</p>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>
